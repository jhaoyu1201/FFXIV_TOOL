<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFXIV å·¨é›†æŒ‡ä»¤ç”¢ç”Ÿå™¨</title>
    <style>
        /* 1. CSS è®Šæ•¸å®šç¾© (é è¨­ç‚ºä¸€èˆ¬æ¨¡å¼) */
        :root {
            /* UI é¡è‰² */
            --bg-color-base: #f4f7f9; /* åŸºç¤èƒŒæ™¯è‰² */
            --pulse-color: #dbeaff;   /* å‘¼å¸å…‰ç›®æ¨™è‰² (æ·ºè—) */
            --text-color: #333;
            --container-bg: #fff;
            --border-color: #e0e0e0;
            --input-bg: #f9f9f9;
            --primary-color: #1e88e5; 
            --copy-button-bg: #f44336;
            --main-button-bg: #4CAF50;
        }

        /* 2. æ·±è‰²æ¨¡å¼è®Šæ•¸ */
        body[data-theme="dark"] {
            --bg-color-base: #222831;
            --pulse-color: #1a1e26;  /* å‘¼å¸å…‰ç›®æ¨™è‰² (æ›´æ·±çš„é»‘) */
            --text-color: #eeeeee;
            --container-bg: #393e46;
            --border-color: #4f5358;
            --input-bg: #4a4e54;
            --primary-color: #00adb5;
            --copy-button-bg: #ff9a3c;
            --main-button-bg: #764BA2;
        }
        
        /* 3. ç²‰è‰²å¤¢å¹»æ¨¡å¼è®Šæ•¸ */
        body[data-theme="pink"] {
            --bg-color-base: #fff0f5;
            --pulse-color: #ffe0ee;  /* å‘¼å¸å…‰ç›®æ¨™è‰² (æ·ºç²‰) */
            --text-color: #5d3954; 
            --container-bg: #ffffff;
            --border-color: #ffc0cb; 
            --input-bg: #ffe0ee;
            --primary-color: #ff69b4; 
            --copy-button-bg: #e91e63;
            --main-button-bg: #ff80a6;
        }

        /* 4. å‘¼å¸å…‰å‹•ç•«å®šç¾© */
        @keyframes breathe {
            0% {
                background-color: var(--bg-color-base);
            }
            50% {
                background-color: var(--pulse-color);
            }
            100% {
                background-color: var(--bg-color-base);
            }
        }

        /* 5. åŸºç¤æ¨£å¼èˆ‡ç‰ˆé¢é…ç½® */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            transition: color 0.3s;
            
            /* å‘¼å¸å…‰èƒŒæ™¯è¨­ç½® */
            background-color: var(--bg-color-base);
            animation: breathe 10s ease-in-out infinite; 
        }
        
        .container {
            background: var(--container-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
        }
        
        h2, h3 {
            color: var(--primary-color); 
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 25px;
            transition: color 0.3s;
        }
        .macro-section {
            padding: 20px 0;
            margin-bottom: 30px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box; 
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        input[type="number"] {
            width: 100px !important; 
            display: inline-block;
        }
        /* å€’æ•¸è¨ˆæ™‚å®¹å™¨çš„æ¨£å¼ */
        .countdown-container {
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: var(--input-bg);
        }
        .countdown-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 8px;
            margin-bottom: 8px;
        }
        .countdown-row label, .countdown-row input, .countdown-row select {
            width: auto;
            margin-bottom: 0;
        }
        .countdown-row input[type="number"], .countdown-row select {
            width: 60px !important;
            padding: 5px;
            margin: 0;
        }
        
        /* å…¶ä»– UI æ¨£å¼ (çœç•¥æœªè®Šæ›´éƒ¨åˆ†) */
        button {
            background-color: var(--main-button-bg); 
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            margin-right: 10px;
            margin-top: 10px;
        }
        button:hover:not(:disabled) {
            filter: brightness(1.1);
        }
        button:disabled {
            background-color: #b0c4de;
            cursor: not-allowed;
            filter: none;
        }
        textarea {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-family: 'Consolas', 'Courier New', monospace; 
            box-sizing: border-box;
            resize: vertical;
            transition: background-color 0.3s, color 0.3s;
        }
        .copy-button {
            background-color: var(--copy-button-bg); 
        }
        .result-title {
            font-style: italic;
            color: var(--text-color);
            opacity: 0.7;
            margin-top: 5px;
            font-size: 0.9em;
        }
        .theme-selector {
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
    </style>
</head>
<body data-theme="light"> 

    <div class="container">
        
        <div class="theme-selector">
            <label for="themeSelector" style="display: inline; margin-right: 15px;">ğŸ¨ é¸æ“‡ UI é¢¨æ ¼ï¼š</label>
            <select id="themeSelector" style="width: auto; display: inline-block;">
                <option value="light">ä¸€èˆ¬æ¨¡å¼</option>
                <option value="dark">æ·±è‰²æ¨¡å¼</option>
                <option value="pink">ç²‰è‰²æ¨¡å¼</option>
            </select>
        </div>

        <h1>ğŸ› ï¸ FFXIV å·¨é›†æŒ‡ä»¤ç”¢ç”Ÿå™¨</h1>
   
        <hr>

        <div class="macro-section">
            <h3>ğŸš‘ æ²»ç™‚æŠ€èƒ½å·¨é›†è¨­å®š</h3>
            
            <label for="healSkillName">è¼¸å…¥æ²»ç™‚æŠ€èƒ½åç¨±ï¼š</label>
            <input type="text" id="healSkillName" placeholder="ä¾‹å¦‚ï¼šå†ç”Ÿ, é‡æˆ°æ²»ç™‚è¡“">

            <div class="countdown-container">
                <label>
                    <input type="checkbox" id="healEnableCountdown"> å•Ÿç”¨å†·å»å€’æ•¸æé†’ (å·¨é›†æŒ‰éˆ•å°‡é–å®š X ç§’)
                </label>
                <div id="healCountdownSettings" style="display:none;">
                    <div class="countdown-row">
                        <label for="healCooldownTime">å†·å»æ™‚é–“ (ç§’)ï¼š</label>
                        <input type="number" id="healCooldownTime" min="4" value="60">
                        <span style="font-size: 0.9em; opacity: 0.8; font-weight: normal;">(æœ€å°‘ 4 ç§’)</span>
                    </div>
                    <div class="countdown-row">
                        <label for="healSoundEffect">æç¤ºéŸ³ç·¨è™Ÿï¼š</label>
                        <select id="healSoundEffect">
                            </select>
                        <span style="font-size: 0.9em; opacity: 0.8; font-weight: normal;">(&lt;se.X&gt;)</span>
                    </div>
                </div>
            </div>


            <label for="targetType">é¸æ“‡æ–½æ”¾ç›®æ¨™é‚è¼¯ï¼š</label>
            <select id="targetType">
                <option value="mo">æŒ‡å‘æ¨¡å¼ (&lt;mo&gt;)</option>
                <option value="me">è‡ªå·±ç‚ºç›®æ¨™ (&lt;me&gt;)</option>
                <option value="t">ç•¶å‰é–å®šç›®æ¨™ (&lt;t&gt;)</option>
                <option value="numbered">æŒ‡å®šéšŠä¼æˆå“¡ (1~8, &lt;X&gt;)</option>
            </select>
            
            <div id="targetNumberContainer" style="display:none; margin-top:10px;">
                <label for="targetNumber">è¼¸å…¥éšŠä¼åˆ—è¡¨è™Ÿç¢¼ (1-8)ï¼š</label>
                <input type="number" id="targetNumber" min="1" max="8" value="1">
            </div>

            <p class="result-title">ç”Ÿæˆçµæœ (è«‹è¤‡è£½ä¸¦è²¼å…¥éŠæˆ²å…§å·¨é›†æ¬„)ï¼š</p>
            <textarea id="healMacroOutput" rows="7" readonly></textarea>

            <button onclick="copyToClipboard('healMacroOutput')" id="copyHealButton" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>

        <hr>

        <div class="macro-section">
            <h3>âš”ï¸ æ”»æ“ŠæŠ€èƒ½å·¨é›†è¨­å®š</h3>

            <label for="dpsSkillName">è¼¸å…¥æ”»æ“ŠæŠ€èƒ½åç¨±ï¼š</label>
            <input type="text" id="dpsSkillName" placeholder="ä¾‹å¦‚ï¼šå´©çŸ³, å‹é¢¨, çˆ†ç™¼">
            
            <div class="countdown-container">
                <label>
                    <input type="checkbox" id="dpsEnableCountdown"> å•Ÿç”¨å†·å»å€’æ•¸æé†’ (å·¨é›†æŒ‰éˆ•å°‡é–å®š X ç§’)
                </label>
                <div id="dpsCountdownSettings" style="display:none;">
                    <div class="countdown-row">
                        <label for="dpsCooldownTime">å†·å»æ™‚é–“ (ç§’)ï¼š</label>
                        <input type="number" id="dpsCooldownTime" min="4" value="120">
                        <span style="font-size: 0.9em; opacity: 0.8; font-weight: normal;">(æœ€å°‘ 4 ç§’)</span>
                    </div>
                    <div class="countdown-row">
                        <label for="dpsSoundEffect">æç¤ºéŸ³ç·¨è™Ÿï¼š</label>
                        <select id="dpsSoundEffect">
                            </select>
                        <span style="font-size: 0.9em; opacity: 0.8; font-weight: normal;">(&lt;se.X&gt;)</span>
                    </div>
                </div>
            </div>

            <label for="dpsTargetMode">é¸æ“‡æ”»æ“Šå·¨é›†æ¨¡å¼ï¼š</label>
            <select id="dpsTargetMode">
                <option value="standard">æ¨™æº–æ¨¡å¼ (/targetenemy)</option>
                <option value="mo_fallback">æŒ‡å‘æ¨¡å¼ (&lt;mo&gt;)</option>
            </select>


            <p class="result-title">ç”Ÿæˆçµæœ (è«‹è¤‡è£½ä¸¦è²¼å…¥éŠæˆ²å…§å·¨é›†æ¬„)ï¼š</p>
            <textarea id="dpsMacroOutput" rows="8" readonly></textarea>

            <button onclick="copyToClipboard('dpsMacroOutput')" id="copyDpsButton" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>

    </div>

    <script>
        // --- é€šç”¨åŠŸèƒ½ï¼šè¤‡è£½åˆ°å‰ªè²¼ç°¿ (é‚è¼¯ä¸è®Š) ---
        function copyToClipboard(elementId) {
            const copyText = document.getElementById(elementId);
            copyText.select(); 
            copyText.setSelectionRange(0, 99999);

            const buttonId = (elementId === 'healMacroOutput') ? 'copyHealButton' : 'copyDpsButton';
            const button = document.getElementById(buttonId);
            const originalText = 'è¤‡è£½æŒ‡ä»¤';

            navigator.clipboard.writeText(copyText.value)
                .then(() => {
                    button.textContent = 'âœ… å·²è¤‡è£½ï¼';
                    setTimeout(() => {
                        button.textContent = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('è¤‡è£½å¤±æ•—: ', err);
                    alert('è¤‡è£½å¤±æ•—ï¼Œæ‚¨çš„ç€è¦½å™¨å¯èƒ½ä¸æ”¯æŒè‡ªå‹•è¤‡è£½ã€‚è«‹æ‰‹å‹•é¸å–è¤‡è£½ã€‚');
                });
        }
        
        // --- å…¨å±€è®Šæ•¸/å¸¸é‡ ---
        const MERROR_OFF = '/merror off\n'; 
        
        // --- åˆå§‹åŒ–ï¼šæç¤ºéŸ³ä¸‹æ‹‰é¸å–® ---
        function populateSoundEffects(selectId) {
            const select = document.getElementById(selectId);
            for (let i = 1; i <= 16; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                select.appendChild(option);
            }
            select.value = 6; 
        }

        // --- A: æ²»ç™‚æŠ€èƒ½å·¨é›†ç”Ÿæˆé‚è¼¯ (æ›´æ–°: éœé»˜ç­‰å¾…) ---
        const healSkillInput = document.getElementById('healSkillName');
        const healMacroOutput = document.getElementById('healMacroOutput');
        const copyHealButton = document.getElementById('copyHealButton');
        const targetTypeSelect = document.getElementById('targetType');
        const targetNumberContainer = document.getElementById('targetNumberContainer');
        const targetNumberInput = document.getElementById('targetNumber');
        const healEnableCountdown = document.getElementById('healEnableCountdown');
        const healCooldownTime = document.getElementById('healCooldownTime');
        const healCountdownSettings = document.getElementById('healCountdownSettings');
        const healSoundEffect = document.getElementById('healSoundEffect');

        // ç›£è½æ‰€æœ‰ç›¸é—œè¼¸å…¥çš„è®ŠåŒ–
        [healSkillInput, targetTypeSelect, targetNumberInput, healCooldownTime, healSoundEffect].forEach(el => {
            if (el) el.addEventListener('input', generateHealMacro);
            if (el) el.addEventListener('change', generateHealMacro);
        });

        healEnableCountdown.addEventListener('change', function() {
            healCountdownSettings.style.display = this.checked ? 'block' : 'none';
            generateHealMacro();
        });

        targetTypeSelect.addEventListener('change', function() {
            targetNumberContainer.style.display = (targetTypeSelect.value === 'numbered') ? 'block' : 'none';
        });


        function generateHealMacro() {
            const skillName = healSkillInput.value.trim();
            const selectedType = targetTypeSelect.value;
            const enableCD = healEnableCountdown.checked;
            const cdTime = parseInt(healCooldownTime.value);
            const soundEffect = healSoundEffect.value;
            let targetParameter = '';
            let macro = '';

            if (!skillName) {
                healMacroOutput.value = '';
                copyHealButton.disabled = true;
                return;
            }
            
            // 1. è™•ç†ç›®æ¨™åƒæ•¸
            switch (selectedType) {
                case 'mo':
                    targetParameter = '<mo>';
                    break;
                case 'me':
                    targetParameter = '<me>';
                    break;
                case 't':
                    targetParameter = '<t>';
                    break;
                case 'numbered':
                    let number = parseInt(targetNumberInput.value);
                    if (number >= 1 && number <= 8) {
                        targetParameter = `<${number}>`;
                    } else {
                        healMacroOutput.value = `éŒ¯èª¤ï¼šè«‹è¼¸å…¥ 1 åˆ° 8 çš„éšŠä¼æˆå“¡è™Ÿç¢¼ï¼`;
                        copyHealButton.disabled = true;
                        return;
                    }
                    break;
            }

            // 2. å†·å»æé†’é‚è¼¯æª¢æŸ¥
            if (enableCD) {
                if (cdTime < 4) {
                    healMacroOutput.value = `éŒ¯èª¤ï¼šå•Ÿç”¨å†·å»æé†’æ™‚ï¼Œå†·å»æ™‚é–“å¿…é ˆå¤§æ–¼æˆ–ç­‰æ–¼ 4 ç§’ï¼`;
                    copyHealButton.disabled = true;
                    return;
                }
            }

            // 3. çµ„è£å·¨é›†æŒ‡ä»¤
            macro += `/micon ${skillName}\n`;
            macro += MERROR_OFF; 
            
            // æŠ€èƒ½æ–½æ”¾
            if (selectedType === 'mo') {
                for (let i = 0; i < 3; i++) {
                    macro += `/ac ${skillName} ${targetParameter}\n`;
                }
            } else {
                macro += `/ac ${skillName} ${targetParameter}\n`;
            }

            // å†·å»æé†’ (åœ¨æŠ€èƒ½åŸ·è¡Œå¾Œæ‰å•Ÿå‹•)
            if (enableCD) {
                // éœé»˜ç­‰å¾…æ™‚é–“ = ç¸½å†·å»æ™‚é–“ - 3 ç§’æé†’æ™‚é–“
                const waitTime = cdTime - 3;
                
                // éœé»˜ç­‰å¾… (å·¨é›†æŒ‰éˆ•é–å®š)
                macro += `/wait ${waitTime}\n`;
                
                // å‰©é¤˜ 3 ç§’æé†’ä¸¦æ’­æ”¾æç¤ºéŸ³ (å·¨é›†åŸ·è¡Œå®Œç•¢ï¼ŒæŒ‰éˆ•è§£é–)
                macro += `/e "[${skillName}]" é‚„æœ‰ 3 ç§’å†·å»å®Œç•¢ï¼ <se.${soundEffect}>`;
            }


            healMacroOutput.value = macro.trim(); 
            copyHealButton.disabled = false;
        }

        // --- B: æ”»æ“ŠæŠ€èƒ½å·¨é›†ç”Ÿæˆé‚è¼¯ (æ›´æ–°: éœé»˜ç­‰å¾…) ---
        const dpsSkillInput = document.getElementById('dpsSkillName');
        const dpsMacroOutput = document.getElementById('dpsMacroOutput');
        const copyDpsButton = document.getElementById('copyDpsButton');
        const dpsTargetModeSelect = document.getElementById('dpsTargetMode');
        const dpsEnableCountdown = document.getElementById('dpsEnableCountdown');
        const dpsCooldownTime = document.getElementById('dpsCooldownTime');
        const dpsCountdownSettings = document.getElementById('dpsCountdownSettings');
        const dpsSoundEffect = document.getElementById('dpsSoundEffect');

        // ç›£è½æ‰€æœ‰ç›¸é—œè¼¸å…¥çš„è®ŠåŒ–
        [dpsSkillInput, dpsTargetModeSelect, dpsCooldownTime, dpsSoundEffect].forEach(el => {
            if (el) el.addEventListener('input', generateDpsMacro);
            if (el) el.addEventListener('change', generateDpsMacro);
        });

        dpsEnableCountdown.addEventListener('change', function() {
            dpsCountdownSettings.style.display = this.checked ? 'block' : 'none';
            generateDpsMacro();
        });


        function generateDpsMacro() {
            const skillName = dpsSkillInput.value.trim();
            const selectedMode = dpsTargetModeSelect.value;
            const enableCD = dpsEnableCountdown.checked;
            const cdTime = parseInt(dpsCooldownTime.value);
            const soundEffect = dpsSoundEffect.value;
            let macro = '';

            if (!skillName) {
                dpsMacroOutput.value = '';
                copyDpsButton.disabled = true;
                return;
            }
            
            // å†·å»æé†’é‚è¼¯æª¢æŸ¥
            if (enableCD) {
                if (cdTime < 4) {
                    dpsMacroOutput.value = `éŒ¯èª¤ï¼šå•Ÿç”¨å†·å»æé†’æ™‚ï¼Œå†·å»æ™‚é–“å¿…é ˆå¤§æ–¼æˆ–ç­‰æ–¼ 4 ç§’ï¼`;
                    copyDpsButton.disabled = true;
                    return;
                }
            }

            // çµ„è£å·¨é›†æŒ‡ä»¤
            macro += `/micon ${skillName}\n`;
            macro += MERROR_OFF;
            
            // æ”»æ“Šæ¨¡å¼
            if (selectedMode === 'standard') {
                macro += `/targetenemy\n`;
                macro += `/ac ${skillName}`;
            } else if (selectedMode === 'mo_fallback') {
                for (let i = 0; i < 3; i++) {
                    macro += `/ac ${skillName} <mo>\n`; 
                }
                macro += `/ac ${skillName} <t>`; 
            }
            
            // è™•ç†æ”»æ“Šæ¨¡å¼ä¸‹çš„æ›è¡Œ
            if (selectedMode === 'standard') {
                macro += `\n`; 
            }

            // å†·å»æé†’ (åœ¨æŠ€èƒ½åŸ·è¡Œå¾Œæ‰å•Ÿå‹•)
            if (enableCD) {
                const waitTime = cdTime - 3;
                
                // éœé»˜ç­‰å¾… (å·¨é›†æŒ‰éˆ•é–å®š)
                macro += `/wait ${waitTime}\n`;
                
                // å‰©é¤˜ 3 ç§’æé†’ä¸¦æ’­æ”¾æç¤ºéŸ³ (å·¨é›†åŸ·è¡Œå®Œç•¢ï¼ŒæŒ‰éˆ•è§£é–)
                macro += `/e "[${skillName}]" é‚„æœ‰ 3 ç§’å†·å»å®Œç•¢ï¼ <se.${soundEffect}>`;
            }

            dpsMacroOutput.value = macro.trim();
            copyDpsButton.disabled = false;
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œåˆå§‹åŒ–å’Œç”Ÿæˆ
        window.addEventListener('load', function() {
            // è¼‰å…¥ä¸»é¡Œ
            const savedTheme = localStorage.getItem('ffxivMacroTheme');
            if (savedTheme) {
                document.body.setAttribute('data-theme', savedTheme);
                document.getElementById('themeSelector').value = savedTheme;
            }

            // åˆå§‹åŒ–æç¤ºéŸ³é¸å–®
            populateSoundEffects('healSoundEffect');
            populateSoundEffects('dpsSoundEffect');

            // åŸ·è¡Œå·¨é›†ç”Ÿæˆ
            generateHealMacro();
            generateDpsMacro();
        });
        
        // --- æ ¸å¿ƒä¸»é¡Œåˆ‡æ›é‚è¼¯ ---
        document.getElementById('themeSelector').addEventListener('change', function() {
            const selectedTheme = this.value;
            document.body.setAttribute('data-theme', selectedTheme);
            localStorage.setItem('ffxivMacroTheme', selectedTheme);
        });

    </script>

</body>
</html>
