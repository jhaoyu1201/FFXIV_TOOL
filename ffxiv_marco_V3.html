<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFXIV å·¨é›†æŒ‡ä»¤ç”¢ç”Ÿå™¨ (v10.8 Warning Edition)</title>
    <style>
        /* CSS è®Šæ•¸ */
        :root {
            --bg-color-base: #f4f7f9;
            --pulse-color: #dbeaff;
            --text-color: #333;
            --container-bg: #fff;
            --border-color: #e0e0e0;
            --input-bg: #f9f9f9;
            --primary-color: #1e88e5; 
            --copy-button-bg: #f44336;
            --main-button-bg: #4CAF50;
            --warning-bg: rgba(255, 152, 0, 0.1);
            --warning-border: #ff9800;
        }

        body[data-theme="dark"] {
            --bg-color-base: #222831;
            --pulse-color: #1a1e26;
            --text-color: #eeeeee;
            --container-bg: #393e46;
            --border-color: #4f5358;
            --input-bg: #4a4e54;
            --primary-color: #00adb5;
            --copy-button-bg: #ff9a3c;
            --main-button-bg: #764BA2;
            --warning-bg: rgba(255, 152, 0, 0.15);
        }
        
        body[data-theme="pink"] {
            --bg-color-base: #fff0f5;
            --pulse-color: #ffe0ee;
            --text-color: #5d3954; 
            --container-bg: #ffffff;
            --border-color: #ffc0cb; 
            --input-bg: #ffe0ee;
            --primary-color: #ff69b4; 
            --copy-button-bg: #e91e63;
            --main-button-bg: #ff80a6;
            --warning-bg: rgba(255, 105, 180, 0.1);
            --warning-border: #ff69b4;
        }

        @keyframes breathe {
            0% { background-color: var(--bg-color-base); }
            50% { background-color: var(--pulse-color); }
            100% { background-color: var(--bg-color-base); }
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Tahoma, sans-serif;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--bg-color-base);
            animation: breathe 10s ease-in-out infinite;
            transition: color 0.3s, background-color 0.3s;
        }
        
        .container {
            background: var(--container-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        h1 { text-align: center; margin-bottom: 30px; }
        h3 { color: var(--primary-color); border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-top: 30px; display: flex; align-items: center; }
        
        .macro-section { padding: 10px 0; margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }

        input[type="text"], input[type="number"], select {
            width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border-color);
            border-radius: 6px; box-sizing: border-box; background-color: var(--input-bg); color: var(--text-color);
        }

        button {
            background-color: var(--main-button-bg); color: white; padding: 10px 20px; border: none;
            border-radius: 6px; cursor: pointer; font-size: 16px; transition: 0.3s; margin-top: 5px;
        }
        button:hover:not(:disabled) { filter: brightness(1.1); }
        button:disabled { background-color: #b0c4de; cursor: not-allowed; }

        textarea { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; background-color: var(--input-bg); color: var(--text-color); font-family: 'Consolas', monospace; resize: vertical; box-sizing: border-box; }
        .copy-button { background-color: var(--copy-button-bg); }

        /* è­¦ç¤ºå€å¡Š */
        .warning-box {
            display: none;
            background-color: var(--warning-bg);
            border-left: 5px solid var(--warning-border);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            font-size: 0.95em;
        }

        /* å½ˆçª—æ¨£å¼ (Modal) */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
        }
        .modal-content {
            background-color: var(--container-bg); margin: 10% auto; padding: 30px; border-radius: 15px;
            max-width: 600px; width: 90%; position: relative; box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            max-height: 80vh; overflow-y: auto;
        }
        .close-modal {
            position: absolute; right: 20px; top: 15px; font-size: 28px; font-weight: bold;
            cursor: pointer; color: #aaa;
        }
        .close-modal:hover { color: var(--text-color); }
        .help-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 22px; height: 22px; background: var(--primary-color); color: white;
            border-radius: 50%; font-size: 14px; cursor: pointer; margin-left: 10px;
        }

        .countdown-container { border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; margin-bottom: 15px; background-color: var(--input-bg); }
        .countdown-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .info-box { background: rgba(0,0,0,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em; border-left: 4px solid var(--primary-color); }
        hr { border: 0; border-top: 1px solid var(--border-color); margin: 40px 0; }
    </style>
</head>
<body data-theme="light"> 

    <div class="container">
        <div style="text-align: right; margin-bottom: 10px;">
            <label style="display: inline; margin-right: 10px;">ğŸ¨ é¢¨æ ¼ï¼š</label>
            <select id="themeSelector" style="width: auto; display: inline-block; margin-bottom: 0;">
                <option value="light">ä¸€èˆ¬æ¨¡å¼</option>
                <option value="dark">æ·±è‰²æ¨¡å¼</option>
                <option value="pink">ç²‰è‰²æ¨¡å¼</option>
            </select>
        </div>

        <h1>ğŸ› ï¸ FFXIV å·¨é›†æŒ‡ä»¤ç”¢ç”Ÿå™¨</h1>

        <div class="macro-section">
            <h3>ğŸš‘ æ²»ç™‚æŠ€èƒ½å·¨é›† <span class="help-icon" onclick="openModal('moModal')">?</span></h3>
            <label for="healSkillName">æŠ€èƒ½åç¨±ï¼š</label>
            <input type="text" id="healSkillName" placeholder="ä¾‹å¦‚ï¼šå†ç”Ÿ, é‡æˆ°æ²»ç™‚è¡“">

            <div class="countdown-container">
                <label><input type="checkbox" id="healEnableCountdown"> å•Ÿç”¨å†·å»å€’æ•¸æé†’</label>
                <div id="healCountdownSettings" style="display:none; margin-top:10px;">
                    <div class="countdown-row">
                        <label>CD (ç§’)ï¼š</label>
                        <input type="number" id="healCooldownTime" min="4" value="60" style="width:70px !important;">
                        <label>éŸ³æ•ˆï¼š</label>
                        <select id="healSoundEffect" style="width:70px !important;"></select>
                    </div>
                </div>
            </div>

            <label>ç›®æ¨™é‚è¼¯ï¼š</label>
            <select id="targetType">
                <option value="mo">æŒ‡å‘æ¨¡å¼ (&lt;mo&gt;)</option>
                <option value="me">è‡ªå·± (&lt;me&gt;)</option>
                <option value="t">ç•¶å‰ç›®æ¨™ (&lt;t&gt;)</option>
                <option value="numbered">éšŠå“¡ç·¨è™Ÿ (1~8)</option>
            </select>
            <div id="targetNumberContainer" style="display:none;">
                <input type="number" id="targetNumber" min="1" max="8" value="1" style="width:70px !important;">
            </div>

            <textarea id="healMacroOutput" rows="6" readonly></textarea>
            <button onclick="copyToClipboard('healMacroOutput', 'copyHealBtn')" id="copyHealBtn" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>

        <hr>

        <div class="macro-section">
            <h3>âš”ï¸ æ”»æ“ŠæŠ€èƒ½å·¨é›†</h3>
            <label for="dpsSkillName">æŠ€èƒ½åç¨±ï¼š</label>
            <input type="text" id="dpsSkillName" placeholder="ä¾‹å¦‚ï¼šå´©çŸ³, å‹é¢¨">
            
            <div class="countdown-container">
                <label><input type="checkbox" id="dpsEnableCountdown"> å•Ÿç”¨å†·å»å€’æ•¸æé†’</label>
                <div id="dpsCountdownSettings" style="display:none; margin-top:10px;">
                    <div class="countdown-row">
                        <label>CD (ç§’)ï¼š</label>
                        <input type="number" id="dpsCooldownTime" min="4" value="120" style="width:70px !important;">
                        <label>éŸ³æ•ˆï¼š</label>
                        <select id="dpsSoundEffect" style="width:70px !important;"></select>
                    </div>
                </div>
            </div>

            <label>æ”»æ“Šæ¨¡å¼ï¼š</label>
            <select id="dpsTargetMode">
                <option value="standard">æ¨™æº–æ¨¡å¼ (/targetenemy)</option>
                <option value="mo_fallback">æŒ‡å‘å„ªå…ˆ (&lt;mo&gt; &gt; &lt;t&gt;)</option>
                <option value="lazy_mode">å…¨è‡ªå‹•æ‡¶äººæ¨¡å¼ (æŒ‡å‘ > ç›®æ¨™ > ç´¢æ•µ > è·Ÿéš¨)</option>
            </select>

            <div id="lazyWarning" class="warning-box">
                âš ï¸ <strong>æ³¨æ„ï¼š</strong>é€™ç¨®æ¨¡å¼åŒ…å«å¤šç¨®è‡ªå‹•æ›ç›®æ¨™æŒ‡ä»¤ï¼Œé€£é»æ™‚æœƒå°è‡´<strong>é–å®šç›®æ¨™é »ç¹è·³å‹•</strong>ï¼Œç„¡æ³•ç©©å®šå°å–®ä¸€ç›®æ¨™è¼¸å‡ºï¼Œè«‹æ…é‡ä½¿ç”¨ã€‚
            </div>

            <textarea id="dpsMacroOutput" rows="6" readonly></textarea>
            <button onclick="copyToClipboard('dpsMacroOutput', 'copyDpsBtn')" id="copyDpsBtn" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>

        <hr>

        <div class="macro-section">
            <h3>ğŸ¯ ç„¦é»æ¨¡å¼ (Focus Target) å°ˆå€ <span class="help-icon" onclick="openModal('focusModal')">?</span></h3>
            <div class="info-box">
                <strong>ç”¨æ³•ï¼š</strong>å°‡ ç‰¹å®šç›®æ¨™ è¨­ç‚ºç„¦é»ï¼Œå³ä½¿ç•¶å‰æ²’æœ‰é–å®šè©²ç›®æ¨™ä¹Ÿèƒ½ä¸€éµæ–½æ”¾æŠ€èƒ½ã€‚
            </div>
            <label>æ­¥é©Ÿ 1ï¼šå¿«é€Ÿè¨­å®šç„¦é»å·¨é›†</label>
            <textarea id="focusSetupMacro" rows="2" readonly>/focustarget <mo>
/e ç„¦é»å·²æ›´æ–° â” <f> <se.15></textarea>
            <button onclick="copyToClipboard('focusSetupMacro', 'copySetBtn')" id="copySetBtn" class="copy-button">è¤‡è£½è¨­å®šæŒ‡ä»¤</button>

            <label style="margin-top:20px;">æ­¥é©Ÿ 2ï¼šç”Ÿæˆç„¦é»å„ªå…ˆæŠ€èƒ½</label>
            <input type="text" id="focusSkillName" placeholder="ä¾‹å¦‚ï¼šæ‰“æ–·, å‚·æ®˜, æ¸›å‚·" oninput="generateFocusMacro()">
            <textarea id="focusMacroOutput" rows="6" readonly></textarea>
            <button onclick="copyToClipboard('focusMacroOutput', 'copyFocusBtn')" id="copyFocusBtn" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>
    </div>

    <div id="moModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('moModal')">&times;</span>
            <h2 style="color:var(--primary-color); margin-top:0;">ğŸ’¡ æŒ‡å‘æ¨¡å¼èªªæ˜</h2>
            <div style="font-size: 0.95em;">
                <p><strong>1. ä»€éº¼æ˜¯æŒ‡å‘æ¨¡å¼ (Mouseover)ï¼Ÿ</strong><br>
                çœå»ã€Œå·¦éµé»æ“Šã€å‹•ä½œï¼Œåªè¦æ¸¸æ¨™æŒ‡è‘—ç›®æ¨™ï¼ˆæˆ–å°éšŠåå–®ï¼‰ï¼ŒæŒ‰ä¸‹æŠ€èƒ½éµå°±æœƒç›´æ¥ç™¼å‹•ã€‚</p>
                <p><strong>2. æŒ‡å‘æ¨¡å¼çš„å¥½è™•</strong><br>
                â€¢ <strong>ä¿æŒé–å®šï¼š</strong> ç•«é¢ä¸­å¿ƒå¯é–å®š BOSS ç›£æ§è®€æ¢ï¼Œæ»‘é¼ åªéœ€åœ¨å´é¢åå–®æ•‘äººã€‚<br>
                â€¢ <strong>å¿«é€Ÿåæ‡‰ï¼š</strong> æ¯”å‚³çµ±é»æ“Šæ›´ä¾¿åˆ©ä¸€é»ï¼Œå¯ä»¥éˆæ´»åæ‡‰çªç™¼ç‹€æ³ã€‚</p>
                <p><strong>3. æ“ä½œå°ç§˜è¨£</strong><br>
                â€¢ <strong>éˆæ´»æ“ä½œï¼š</strong> æ»‘é¼ åªéœ€åœ¨ã€ŒæŒ‰ä¸‹çš„ç¬é–“ã€æŒ‡è‘—å°è±¡ï¼ŒæŠ€èƒ½ç™¼å‹•å¾Œå³å¯è‡ªç”±ç§»é–‹ã€‚<br>
                â€¢ <strong>å‚™æ¡ˆè£œå……ï¼š</strong> è‹¥æ»‘é¼ æ²’æŒ‡è‘—ä»»ä½•äººï¼Œå·¨é›†æœƒè‡ªå‹•æ”¹å°ä½ ã€Œç•¶å‰é¸ä¸­ç›®æ¨™ã€æ–½æ”¾ã€‚</p>
            </div>
            <button onclick="closeModal('moModal')" style="width:100%; margin-top:10px;">ç­è§£äº†!</button>
        </div>
    </div>

    <div id="focusModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('focusModal')">&times;</span>
            <h2 style="color:var(--primary-color); margin-top:0;">ğŸ¯ ç„¦é»æ¨¡å¼ (Focus Target) æŒ‡å—</h2>
            <div style="font-size: 0.95em;">
                <p><strong>1. ç‚ºä»€éº¼è¦è¨­å®šç„¦é»ç›®æ¨™ï¼Ÿ</strong><br>
                å°‡ä¸»è¦æ•µäººæˆ–éšŠå‹è¨­ç‚ºã€Œç„¦é»ã€ï¼Œå°±åƒè£äº† GPSï¼Œç„¡è«–ä¸»ç›®æ¨™å¦‚ä½•åˆ‡æ›ï¼Œéƒ½èƒ½æŒæ¡ç„¦é»ç›®æ¨™çš„ç‹€æ³èˆ‡è®€æ¢ã€‚</p>
                <p><strong>2. ç„¦é»æ¨¡å¼çš„å¥½è™•ï¼šè¼”åŠ©èˆ‡æ¸›å‚·</strong><br>
                â€¢ <strong>ä¸ä¸Ÿå¤±æ”»æ“Šç¯€å¥ï¼š</strong> è£œè·å¯å°‡å¦è¨­ç‚ºç„¦é»ï¼Œå³ä¾¿æ­£ç›¯è‘— BOSS æ‰“ï¼Œä¹Ÿèƒ½é€éå·¨é›†ä¸€éµå°ç„¦é»ç›®æ¨™æ–½æ”¾æ¸›å‚·æˆ–æ²»ç™‚ï¼Œä¸éœ€åˆ‡æ›ç›®æ¨™ã€‚</p>
                <p><strong>3. ç„¦é»æ¨¡å¼çš„å¥½è™•ï¼šæ”»æ“Šèˆ‡æ‰“æ–·</strong><br>
                â€¢ <strong>ç²¾æº–æ‰“æ–·ï¼š</strong> åœ¨å ´ä¸Šæœ‰è¤‡æ•¸æ•µäººæ™‚ï¼Œå°‡éœ€æ‰“æ–·çš„ç›®æ¨™è¨­ç‚ºç„¦é»ï¼Œä¸€æ—¦çœ‹åˆ°ç„¦é»ç›®æ¨™è®€æ¢ï¼Œä¸€éµæŒ‰ä¸‹å»å³è‡ªå‹•æ–½æ”¾æ‰“æ–·æŠ€ï¼Œä¸å¿…æ‰‹å¿™è…³äº‚æ‰¾æ€ªã€‚</p>
            </div>
            <button onclick="closeModal('focusModal')" style="width:100%; margin-top:10px;">ç­è§£äº†!</button>
        </div>
    </div>

    <script>
        // å½ˆçª—æ§åˆ¶
        function openModal(modalId) { document.getElementById(modalId).style.display = 'block'; }
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = 'none';
            }
        }

        // è¤‡è£½èˆ‡æŒ‡ä»¤ç”Ÿæˆ
        function copyToClipboard(elementId, buttonId) {
            const text = document.getElementById(elementId);
            const btn = document.getElementById(buttonId);
            const original = btn.textContent;
            text.select();
            navigator.clipboard.writeText(text.value).then(() => {
                btn.textContent = 'âœ… å·²è¤‡è£½ï¼';
                setTimeout(() => btn.textContent = original, 2000);
            });
        }

        const M_ERR = '/merror off\n';

        function initSounds(id) {
            const s = document.getElementById(id);
            for(let i=1; i<=16; i++) {
                let opt = document.createElement('option');
                opt.value = i; opt.textContent = i;
                s.appendChild(opt);
            }
            s.value = 6;
        }

        function generateHeal() {
            const skill = document.getElementById('healSkillName').value.trim();
            const out = document.getElementById('healMacroOutput');
            const btn = document.getElementById('copyHealBtn');
            if(!skill) { out.value = ''; btn.disabled = true; return; }
            let target = document.getElementById('targetType').value;
            if(target === 'numbered') target = document.getElementById('targetNumber').value;
            let macro = `/micon ${skill}\n${M_ERR}`;
            if(target === 'mo') {
                for(let i=0; i<3; i++) macro += `/ac ${skill} <mo>\n`;
                macro += `/ac ${skill} <t>\n`; 
            } else {
                macro += `/ac ${skill} <${target}>\n`;
            }
            if(document.getElementById('healEnableCountdown').checked) {
                let cd = parseInt(document.getElementById('healCooldownTime').value);
                if(cd >= 4) macro += `/wait ${cd-3}\n/e [${skill}] å‰© 3 ç§’ï¼ <se.${document.getElementById('healSoundEffect').value}>`;
            }
            out.value = macro.trim(); btn.disabled = false;
        }

        function generateDps() {
            const skill = document.getElementById('dpsSkillName').value.trim();
            const out = document.getElementById('dpsMacroOutput');
            const btn = document.getElementById('copyDpsBtn');
            const mode = document.getElementById('dpsTargetMode').value;
            
            // è™•ç†è­¦ç¤ºé¡¯éš±
            const warningBox = document.getElementById('lazyWarning');
            warningBox.style.display = (mode === 'lazy_mode') ? 'block' : 'none';

            if(!skill) { out.value = ''; btn.disabled = true; return; }
            let macro = `/micon ${skill}\n${M_ERR}`;
            if(mode === 'standard') { macro += `/targetenemy\n/ac ${skill}\n`; } 
            else if(mode === 'mo_fallback') {
                for(let i=0; i<3; i++) macro += `/ac ${skill} <mo>\n`;
                macro += `/ac ${skill} <t>\n`;
            } else if(mode === 'lazy_mode') {
                macro += `/ac ${skill} <mo>\n/ac ${skill} <t>\n/targetenemy\n/ac ${skill} <t>\n/as <2>\n/ac ${skill} <t>\n`;
            }
            if(document.getElementById('dpsEnableCountdown').checked) {
                let cd = parseInt(document.getElementById('dpsCooldownTime').value);
                if(cd >= 4) macro += `/wait ${cd-3}\n/e [${skill}] å‰© 3 ç§’ï¼ <se.${document.getElementById('dpsSoundEffect').value}>`;
            }
            out.value = macro.trim(); btn.disabled = false;
        }

        function generateFocusMacro() {
            const skill = document.getElementById('focusSkillName').value.trim();
            const out = document.getElementById('focusMacroOutput');
            const btn = document.getElementById('copyFocusBtn');
            if(!skill) { out.value = ''; btn.disabled = true; return; }
            let macro = `/micon ${skill}\n${M_ERR}`;
            for(let i=0; i<3; i++) macro += `/ac ${skill} <f>\n`;
            macro += `/ac ${skill} <t>`;
            out.value = macro.trim(); btn.disabled = false;
        }

        const inputs = ['healSkillName', 'targetType', 'targetNumber', 'healEnableCountdown', 'healCooldownTime', 'healSoundEffect',
                      'dpsSkillName', 'dpsTargetMode', 'dpsEnableCountdown', 'dpsCooldownTime', 'dpsSoundEffect'];
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', () => { generateHeal(); generateDps(); });
        });
        document.getElementById('healEnableCountdown').addEventListener('change', e => document.getElementById('healCountdownSettings').style.display = e.target.checked ? 'block' : 'none');
        document.getElementById('dpsEnableCountdown').addEventListener('change', e => document.getElementById('dpsCountdownSettings').style.display = e.target.checked ? 'block' : 'none');
        document.getElementById('targetType').addEventListener('change', e => document.getElementById('targetNumberContainer').style.display = e.target.value === 'numbered' ? 'block' : 'none');
        document.getElementById('themeSelector').addEventListener('change', function() {
            document.body.setAttribute('data-theme', this.value);
            localStorage.setItem('ffxivMacroTheme', this.value);
        });

        window.onload = () => {
            initSounds('healSoundEffect'); initSounds('dpsSoundEffect');
            const theme = localStorage.getItem('ffxivMacroTheme') || 'light';
            document.body.setAttribute('data-theme', theme);
            document.getElementById('themeSelector').value = theme;
        };
    </script>
</body>
</html>
