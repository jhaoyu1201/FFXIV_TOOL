<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFXIV å·¨é›†æŒ‡ä»¤ç”¢ç”Ÿå™¨ (v10.2 Final)</title>
    <style>
        /* 1. CSS è®Šæ•¸å®šç¾© */
        :root {
            --bg-color-base: #f4f7f9;
            --pulse-color: #dbeaff;
            --text-color: #333;
            --container-bg: #fff;
            --border-color: #e0e0e0;
            --input-bg: #f9f9f9;
            --primary-color: #1e88e5; 
            --copy-button-bg: #f44336;
            --main-button-bg: #4CAF50;
        }

        body[data-theme="dark"] {
            --bg-color-base: #222831;
            --pulse-color: #1a1e26;
            --text-color: #eeeeee;
            --container-bg: #393e46;
            --border-color: #4f5358;
            --input-bg: #4a4e54;
            --primary-color: #00adb5;
            --copy-button-bg: #ff9a3c;
            --main-button-bg: #764BA2;
        }
        
        body[data-theme="pink"] {
            --bg-color-base: #fff0f5;
            --pulse-color: #ffe0ee;
            --text-color: #5d3954; 
            --container-bg: #ffffff;
            --border-color: #ffc0cb; 
            --input-bg: #ffe0ee;
            --primary-color: #ff69b4; 
            --copy-button-bg: #e91e63;
            --main-button-bg: #ff80a6;
        }

        /* 2. å‘¼å¸å…‰å‹•ç•« */
        @keyframes breathe {
            0% { background-color: var(--bg-color-base); }
            50% { background-color: var(--pulse-color); }
            100% { background-color: var(--bg-color-base); }
        }

        /* 3. ç‰ˆé¢é…ç½® */
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Tahoma, sans-serif;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--bg-color-base);
            animation: breathe 10s ease-in-out infinite;
            transition: color 0.3s, background-color 0.3s;
        }
        
        .container {
            background: var(--container-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        h1 { text-align: center; margin-bottom: 30px; }
        h3 { color: var(--primary-color); border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-top: 30px; }
        
        .macro-section { padding: 10px 0; margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }

        input[type="text"], input[type="number"], select {
            width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border-color);
            border-radius: 6px; box-sizing: border-box; background-color: var(--input-bg); color: var(--text-color);
        }

        .countdown-container { border: 1px solid var(--border-color); padding: 15px; border-radius: 8px; margin-bottom: 15px; background-color: var(--input-bg); }
        .countdown-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }

        button {
            background-color: var(--main-button-bg); color: white; padding: 10px 20px; border: none;
            border-radius: 6px; cursor: pointer; font-size: 16px; transition: 0.3s; margin-top: 5px;
        }
        button:hover:not(:disabled) { filter: brightness(1.1); }
        button:disabled { background-color: #b0c4de; cursor: not-allowed; }

        textarea { width: 100%; padding: 10px; margin-top: 10px; border-radius: 6px; background-color: var(--input-bg); color: var(--text-color); font-family: 'Consolas', monospace; resize: vertical; box-sizing: border-box; }
        .copy-button { background-color: var(--copy-button-bg); }
        
        .info-box { background: rgba(0,0,0,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9em; border-left: 4px solid var(--primary-color); }
        .tip-box { background: rgba(255, 193, 7, 0.1); padding: 10px; border-radius: 6px; font-size: 0.85em; border-left: 4px solid #ffc107; margin-top: 10px; }
        hr { border: 0; border-top: 1px solid var(--border-color); margin: 40px 0; }
    </style>
</head>
<body data-theme="light"> 

    <div class="container">
        <div style="text-align: right; margin-bottom: 10px;">
            <label style="display: inline; margin-right: 10px;">ğŸ¨ é¢¨æ ¼ï¼š</label>
            <select id="themeSelector" style="width: auto; display: inline-block; margin-bottom: 0;">
                <option value="light">ä¸€èˆ¬æ¨¡å¼</option>
                <option value="dark">æ·±è‰²æ¨¡å¼</option>
                <option value="pink">ç²‰è‰²æ¨¡å¼</option>
            </select>
        </div>

        <h1>ğŸ› ï¸ FFXIV å·¨é›†æŒ‡ä»¤ç”¢ç”Ÿå™¨</h1>

        <div class="macro-section">
            <h3>ğŸš‘ æ²»ç™‚æŠ€èƒ½å·¨é›†</h3>
            <label for="healSkillName">æŠ€èƒ½åç¨±ï¼š</label>
            <input type="text" id="healSkillName" placeholder="ä¾‹å¦‚ï¼šå†ç”Ÿ, é‡æˆ°æ²»ç™‚è¡“">

            <div class="countdown-container">
                <label><input type="checkbox" id="healEnableCountdown"> å•Ÿç”¨å†·å»å€’æ•¸æé†’</label>
                <div id="healCountdownSettings" style="display:none; margin-top:10px;">
                    <div class="countdown-row">
                        <label>CD (ç§’)ï¼š</label>
                        <input type="number" id="healCooldownTime" min="4" value="60" style="width:70px !important;">
                        <label>éŸ³æ•ˆï¼š</label>
                        <select id="healSoundEffect" style="width:70px !important;"></select>
                    </div>
                </div>
            </div>

            <label>ç›®æ¨™é‚è¼¯ï¼š</label>
            <select id="targetType">
                <option value="mo">æŒ‡å‘æ¨¡å¼ (&lt;mo&gt;)</option>
                <option value="me">è‡ªå·± (&lt;me&gt;)</option>
                <option value="t">ç•¶å‰ç›®æ¨™ (&lt;t&gt;)</option>
                <option value="numbered">éšŠä¼ç·¨è™Ÿ (1~8)</option>
            </select>
            <div id="targetNumberContainer" style="display:none;">
                <input type="number" id="targetNumber" min="1" max="8" value="1" style="width:70px !important;">
            </div>

            <textarea id="healMacroOutput" rows="6" readonly></textarea>
            <button onclick="copyToClipboard('healMacroOutput', 'copyHealBtn')" id="copyHealBtn" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>

        <hr>

        <div class="macro-section">
            <h3>âš”ï¸ æ”»æ“ŠæŠ€èƒ½å·¨é›†</h3>
            <label for="dpsSkillName">æŠ€èƒ½åç¨±ï¼š</label>
            <input type="text" id="dpsSkillName" placeholder="ä¾‹å¦‚ï¼šå´©çŸ³, å‹é¢¨">
            
            <div class="countdown-container">
                <label><input type="checkbox" id="dpsEnableCountdown"> å•Ÿç”¨å†·å»å€’æ•¸æé†’</label>
                <div id="dpsCountdownSettings" style="display:none; margin-top:10px;">
                    <div class="countdown-row">
                        <label>CD (ç§’)ï¼š</label>
                        <input type="number" id="dpsCooldownTime" min="4" value="120" style="width:70px !important;">
                        <label>éŸ³æ•ˆï¼š</label>
                        <select id="dpsSoundEffect" style="width:70px !important;"></select>
                    </div>
                </div>
            </div>

            <label>æ”»æ“Šæ¨¡å¼ï¼š</label>
            <select id="dpsTargetMode">
                <option value="standard">æ¨™æº– (/targetenemy)</option>
                <option value="mo_fallback">æŒ‡å‘å„ªå…ˆ (&lt;mo&gt; &gt; &lt;t&gt;)</option>
            </select>

            <textarea id="dpsMacroOutput" rows="6" readonly></textarea>
            <button onclick="copyToClipboard('dpsMacroOutput', 'copyDpsBtn')" id="copyDpsBtn" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>

        <hr>

        <div class="macro-section">
            <h3>ğŸ¯ ç„¦é»ç›®æ¨™ (Focus Target) å°ˆå€</h3>
            <div class="info-box">
                <strong>ç”¨æ³•ï¼š</strong>å°‡ BOSS è¨­ç‚ºç„¦é»ï¼Œå³ä½¿ç•¶å‰åœ¨æ‰“å°æ€ªä¹Ÿèƒ½å° BOSS æ–½æ”¾æŠ€èƒ½ã€‚
            </div>

            <label>æ­¥é©Ÿ 1ï¼šå¿«é€Ÿè¨­å®šç„¦é»å·¨é›†</label>
            <textarea id="focusSetupMacro" rows="2" readonly>/focustarget <mo>
/e ç„¦é»å·²æ›´æ–° â” <f> <se.15></textarea>
            <button onclick="copyToClipboard('focusSetupMacro', 'copySetBtn')" id="copySetBtn" class="copy-button">è¤‡è£½è¨­å®šæŒ‡ä»¤</button>

            <label style="margin-top:20px;">æ­¥é©Ÿ 2ï¼šç”Ÿæˆç„¦é»å„ªå…ˆæŠ€èƒ½</label>
            <input type="text" id="focusSkillName" placeholder="ä¾‹å¦‚ï¼šæ‰“æ–·, å‚·æ®˜, æ¸›å‚·" oninput="generateFocusMacro()">
            
            <div class="tip-box">
                <strong>âš ï¸ æ‰‹æ„Ÿæé†’ï¼š</strong>é‡è¤‡æŒ‡ä»¤æ˜¯ç‚ºäº†æŠµéŠ·å»¶é²ï¼Œè«‹æŒ‰ 1-2 ä¸‹å³å¯ï¼Œé€£æ‰“æŒ‰éˆ•å¯èƒ½æœƒå¾®å¹…å¡åˆ°ä¸‹å€‹æŠ€èƒ½ã€‚
            </div>

            <textarea id="focusMacroOutput" rows="6" readonly></textarea>
            <button onclick="copyToClipboard('focusMacroOutput', 'copyFocusBtn')" id="copyFocusBtn" class="copy-button" disabled>è¤‡è£½æŒ‡ä»¤</button>
        </div>
    </div>

    <script>
        // é€šç”¨è¤‡è£½åŠŸèƒ½
        function copyToClipboard(elementId, buttonId) {
            const text = document.getElementById(elementId);
            const btn = document.getElementById(buttonId);
            const original = btn.textContent;
            text.select();
            navigator.clipboard.writeText(text.value).then(() => {
                btn.textContent = 'âœ… å·²è¤‡è£½ï¼';
                setTimeout(() => btn.textContent = original, 2000);
            });
        }

        const M_ERR = '/merror off\n';

        // åˆå§‹åŒ–éŸ³æ•ˆé¸å–®
        function initSounds(id) {
            const s = document.getElementById(id);
            for(let i=1; i<=16; i++) {
                let opt = document.createElement('option');
                opt.value = i; opt.textContent = i;
                s.appendChild(opt);
            }
            s.value = 6;
        }

        // æ²»ç™‚å·¨é›†é‚è¼¯
        function generateHeal() {
            const skill = document.getElementById('healSkillName').value.trim();
            const out = document.getElementById('healMacroOutput');
            const btn = document.getElementById('copyHealBtn');
            if(!skill) { out.value = ''; btn.disabled = true; return; }

            let target = document.getElementById('targetType').value;
            if(target === 'numbered') target = document.getElementById('targetNumber').value;
            
            let macro = `/micon ${skill}\n${M_ERR}`;
            if(target === 'mo') {
                for(let i=0; i<3; i++) macro += `/ac ${skill} <mo>\n`;
            } else {
                macro += `/ac ${skill} <${target}>\n`;
            }

            if(document.getElementById('healEnableCountdown').checked) {
                let cd = parseInt(document.getElementById('healCooldownTime').value);
                if(cd >= 4) macro += `/wait ${cd-3}\n/e [${skill}] å‰© 3 ç§’ï¼ <se.${document.getElementById('healSoundEffect').value}>`;
            }
            out.value = macro.trim(); btn.disabled = false;
        }

        // æ”»æ“Šå·¨é›†é‚è¼¯
        function generateDps() {
            const skill = document.getElementById('dpsSkillName').value.trim();
            const out = document.getElementById('dpsMacroOutput');
            const btn = document.getElementById('copyDpsBtn');
            if(!skill) { out.value = ''; btn.disabled = true; return; }

            let macro = `/micon ${skill}\n${M_ERR}`;
            if(document.getElementById('dpsTargetMode').value === 'standard') {
                macro += `/targetenemy\n/ac ${skill}\n`;
            } else {
                for(let i=0; i<3; i++) macro += `/ac ${skill} <mo>\n`;
                macro += `/ac ${skill} <t>\n`;
            }

            if(document.getElementById('dpsEnableCountdown').checked) {
                let cd = parseInt(document.getElementById('dpsCooldownTime').value);
                if(cd >= 4) macro += `/wait ${cd-3}\n/e [${skill}] å‰© 3 ç§’ï¼ <se.${document.getElementById('dpsSoundEffect').value}>`;
            }
            out.value = macro.trim(); btn.disabled = false;
        }

        // ç„¦é»å·¨é›†é‚è¼¯
        function generateFocusMacro() {
            const skill = document.getElementById('focusSkillName').value.trim();
            const out = document.getElementById('focusMacroOutput');
            const btn = document.getElementById('copyFocusBtn');
            if(!skill) { out.value = ''; btn.disabled = true; return; }

            let macro = `/micon ${skill}\n${M_ERR}`;
            for(let i=0; i<3; i++) macro += `/ac ${skill} <f>\n`;
            macro += `/ac ${skill} <t>`;
            out.value = macro.trim(); btn.disabled = false;
        }

        // äº‹ä»¶ç›£è½
        const inputs = ['healSkillName', 'targetType', 'targetNumber', 'healEnableCountdown', 'healCooldownTime', 'healSoundEffect',
                      'dpsSkillName', 'dpsTargetMode', 'dpsEnableCountdown', 'dpsCooldownTime', 'dpsSoundEffect'];
        
        inputs.forEach(id => {
            document.getElementById(id).addEventListener('input', () => { generateHeal(); generateDps(); });
        });

        document.getElementById('healEnableCountdown').addEventListener('change', e => document.getElementById('healCountdownSettings').style.display = e.target.checked ? 'block' : 'none');
        document.getElementById('dpsEnableCountdown').addEventListener('change', e => document.getElementById('dpsCountdownSettings').style.display = e.target.checked ? 'block' : 'none');
        document.getElementById('targetType').addEventListener('change', e => document.getElementById('targetNumberContainer').style.display = e.target.value === 'numbered' ? 'block' : 'none');

        // ä¸»é¡Œåˆå§‹åŒ–
        document.getElementById('themeSelector').addEventListener('change', function() {
            document.body.setAttribute('data-theme', this.value);
            localStorage.setItem('ffxivMacroTheme', this.value);
        });

        window.onload = () => {
            initSounds('healSoundEffect'); initSounds('dpsSoundEffect');
            const theme = localStorage.getItem('ffxivMacroTheme') || 'light';
            document.body.setAttribute('data-theme', theme);
            document.getElementById('themeSelector').value = theme;
        };
    </script>
</body>
</html>
